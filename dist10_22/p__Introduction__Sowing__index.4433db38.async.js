"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[910],{82061:function($,B,s){var T=s(1413),b=s(67294),y=s(47046),_=s(91146),A=function(g,R){return b.createElement(_.Z,(0,T.Z)((0,T.Z)({},g),{},{ref:R,icon:y.Z}))},v=b.forwardRef(A);B.Z=v},33349:function($,B,s){s.r(B);var T=s(19632),b=s.n(T),y=s(15009),_=s.n(y),A=s(97857),v=s.n(A),K=s(99289),g=s.n(K),R=s(5574),w=s.n(R),z=s(6110),J=s(29966),E=s(67294),c=s(2453),M=s(17788),j=s(83622),N=s(76772),V=s(82061),p=s(85893),G=function(){var Q=(0,E.useRef)(),Z=(0,N.useLocation)(),H=(0,E.useState)([]),U=w()(H,2),h=U[0],C=U[1],X=(0,E.useState)([]),F=w()(X,2),Y=F[0],P=F[1],x=(0,E.useState)([]),W=w()(x,2),D=W[0],I=W[1],S=localStorage.getItem("token"),O=function(){var l=g()(_()().mark(function u(){var n,t,o;return _()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,fetch("/api/introduction/getIntroductionSow",{headers:{Authorization:"Bearer ".concat(S)}});case 3:if(n=a.sent,n.ok){a.next=6;break}throw new Error("\u7F51\u7EDC\u9519\u8BEF");case 6:return a.next=8,n.json();case 8:t=a.sent,Array.isArray(t.data)?(o=t.data.map(function(d,r){var e,m;return v()(v()({},d),{},{key:(e=(m=d.key)!==null&&m!==void 0?m:d.id)!==null&&e!==void 0?e:d.plantingCode+"_"+d.code+"_"+r})}),C(o),P(o)):(C([]),P([])),a.next=17;break;case 12:a.prev=12,a.t0=a.catch(0),c.ZP.error("\u83B7\u53D6\u64AD\u79CD\u8BB0\u5F55\u5931\u8D25"),C([]),P([]);case 17:case"end":return a.stop()}},u,null,[[0,12]])}));return function(){return l.apply(this,arguments)}}();(0,E.useEffect)(function(){O()},[]),(0,E.useEffect)(function(){var l=Z.state,u=l||{},n=u.sowingRecord;n&&!h.some(function(t){return t.key===n.key})&&C(function(t){return[].concat(b()(t),[n])})},[Z.state]),(0,E.useEffect)(function(){localStorage.setItem("sowingRecords",JSON.stringify(h))},[h]);var q=function(u,n){var t=h,o=n.introductionTimeRange;if(o&&Array.isArray(o)){var f=w()(o,2),a=f[0],d=f[1];t=t.filter(function(r){var e=new Date(r.introductionTime).getTime();return e>=new Date(a).getTime()&&e<=new Date(d).getTime()})}n.plantingCode&&(t=t.filter(function(r){var e;return((e=r.plantingCode)!==null&&e!==void 0?e:"").toString().includes(n.plantingCode)})),n.code&&(t=t.filter(function(r){var e;return((e=r.code)!==null&&e!==void 0?e:"").toString().includes(n.code)})),n.name&&(t=t.filter(function(r){var e;return((e=r.name)!==null&&e!==void 0?e:"").toString().includes(n.name)})),n.method&&(t=t.filter(function(r){var e;return((e=r.method)!==null&&e!==void 0?e:"").toString().includes(n.method)})),n.type&&(t=t.filter(function(r){var e;return((e=r.type)!==null&&e!==void 0?e:"").toString().includes(n.type)})),n.isRegular&&(t=t.filter(function(r){var e;return((e=r.isRegular)!==null&&e!==void 0?e:"").toString().includes(n.isRegular)})),n.generation&&(t=t.filter(function(r){var e;return((e=r.generation)!==null&&e!==void 0?e:"").toString().includes(n.generation)})),n.sowingAmount&&(t=t.filter(function(r){var e;return String((e=r.sowingAmount)!==null&&e!==void 0?e:"").includes(n.sowingAmount)})),n.planCode&&(t=t.filter(function(r){var e;return((e=r.planCode)!==null&&e!==void 0?e:"").toString().includes(n.planCode)})),n.sowingTime&&(t=t.filter(function(r){var e;return((e=r.sowingTime)!==null&&e!==void 0?e:"").toString().includes(n.sowingTime)})),n.status&&(t=t.filter(function(r){var e;return((e=r.status)!==null&&e!==void 0?e:"").toString().includes(n.status)})),P(t)},ee=function(u){M.Z.confirm({title:"\u786E\u8BA4\u5220\u9664",content:"\u786E\u5B9A\u8981\u5220\u9664\u79CD\u690D\u7F16\u53F7\u4E3A ".concat(u.plantingCode," \u7684\u8BB0\u5F55\u5417\uFF1F"),onOk:function(){var n=g()(_()().mark(function o(){var f,a,d;return _()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("/api/introduction/introductionSowDelete?plantid=".concat(u.plantingCode),{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(S)}});case 3:return f=e.sent,e.next=6,f.json();case 6:a=e.sent,a&&(a.success||a.code===200||a.msg==="SUCCESS")?(d=h.filter(function(m){return m.plantingCode!==u.plantingCode}),C(d),c.ZP.success("\u5220\u9664\u6210\u529F"),O()):c.ZP.error((a==null?void 0:a.msg)||"\u5220\u9664\u5931\u8D25"),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),c.ZP.error("\u5220\u9664\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5");case 13:case"end":return e.stop()}},o,null,[[0,10]])}));function t(){return n.apply(this,arguments)}return t}()})},ne=function(){var l=g()(_()().mark(function u(){return _()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(D.length!==0){t.next=3;break}return c.ZP.warning("\u8BF7\u9009\u62E9\u8981\u5220\u9664\u7684\u8BB0\u5F55"),t.abrupt("return");case 3:M.Z.confirm({title:"\u786E\u8BA4\u6279\u91CF\u5220\u9664",content:"\u786E\u5B9A\u8981\u5220\u9664\u9009\u4E2D\u7684 ".concat(D.length," \u6761\u8BB0\u5F55\u5417\uFF1F"),okText:"\u786E\u8BA4",cancelText:"\u53D6\u6D88",onOk:function(){var o=g()(_()().mark(function a(){var d,r,e;return _()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,d=D.map(function(k){var L=h.find(function(ae){return ae.key===k});return L==null?void 0:L.plantingCode}).filter(Boolean),i.next=4,fetch("/api/introduction/BatchDeleteSow",{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(S)},body:JSON.stringify({keys:d})});case 4:return r=i.sent,i.next=7,r.json();case 7:if(e=i.sent,!(e&&(e.success||e.code===200||e.msg==="SUCCESS"))){i.next=16;break}return C(h.filter(function(k){return!d.includes(k.plantingCode)})),I([]),i.next=13,O();case 13:c.ZP.success("\u5DF2\u5220\u9664 ".concat(d.length," \u6761\u8BB0\u5F55")),i.next=17;break;case 16:c.ZP.error((e==null?void 0:e.msg)||"\u6279\u91CF\u5220\u9664\u5931\u8D25");case 17:i.next=22;break;case 19:i.prev=19,i.t0=i.catch(0),c.ZP.error("\u6279\u91CF\u5220\u9664\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5");case 22:case"end":return i.stop()}},a,null,[[0,19]])}));function f(){return o.apply(this,arguments)}return f}()});case 4:case"end":return t.stop()}},u)}));return function(){return l.apply(this,arguments)}}(),ie=function(){var l=g()(_()().mark(function u(){return _()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(D.length!==0){t.next=3;break}return c.ZP.warning("\u8BF7\u9009\u62E9\u8981\u6279\u91CF\u64AD\u79CD\u7684\u8BB0\u5F55"),t.abrupt("return");case 3:M.Z.confirm({title:"\u786E\u8BA4\u6279\u91CF\u64AD\u79CD",content:"\u786E\u5B9A\u8981\u6279\u91CF\u64AD\u79CD\u9009\u4E2D\u7684 ".concat(D.length," \u6761\u8BB0\u5F55\u5417\uFF1F"),okText:"\u786E\u8BA4",cancelText:"\u53D6\u6D88",onOk:function(){var o=g()(_()().mark(function a(){var d,r,e;return _()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,d=D,i.next=4,fetch("/api/introduction/BatchSowing",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(S)},body:JSON.stringify({plantingCodes:d})});case 4:return r=i.sent,i.next=7,r.json();case 7:e=i.sent,e&&(e.success||e.code===200||e.msg==="SUCCESS")?(c.ZP.success("\u5DF2\u6279\u91CF\u64AD\u79CD ".concat(d.length," \u6761\u8BB0\u5F55")),I([]),O()):c.ZP.error((e==null?void 0:e.msg)||"\u6279\u91CF\u64AD\u79CD\u5931\u8D25"),i.next=14;break;case 11:i.prev=11,i.t0=i.catch(0),c.ZP.error("\u6279\u91CF\u64AD\u79CD\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5");case 14:case"end":return i.stop()}},a,null,[[0,11]])}));function f(){return o.apply(this,arguments)}return f}()});case 4:case"end":return t.stop()}},u)}));return function(){return l.apply(this,arguments)}}(),te=function(){var l=g()(_()().mark(function u(n){var t,o,f,a;return _()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,fetch("/api/introduction/examination",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(S)},body:JSON.stringify(n)});case 3:return t=r.sent,r.next=6,t.json();case 6:if(o=r.sent,!(o&&(o.success||o.code===200||o.msg==="SUCCESS"))){r.next=17;break}return f=o.data.state?"\u672A\u8003\u79CD":"\u5DF2\u8003\u79CD",a=h.map(function(e){return e.key===n.key?v()(v()({},e),{},{status:f}):e}),C(a),P(function(e){return e.map(function(m){return m.key===n.key?v()(v()({},m),{},{status:f}):m})}),r.next=14,O();case 14:c.ZP.success(f==="\u5DF2\u8003\u79CD"?"\u5DF2\u5B8C\u6210\u8003\u79CD":"\u8003\u79CD\u8BB0\u5F55\u751F\u6210\u6210\u529F"),r.next=18;break;case 17:c.ZP.error((o==null?void 0:o.msg)||"\u8003\u79CD\u5931\u8D25");case 18:r.next=23;break;case 20:r.prev=20,r.t0=r.catch(0),c.ZP.error("\u8003\u79CD\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5");case 23:case"end":return r.stop()}},u,null,[[0,20]])}));return function(n){return l.apply(this,arguments)}}(),re=[{title:"\u79CD\u690D\u7F16\u53F7",dataIndex:"plantingCode"},{title:"\u7F16\u53F7",dataIndex:"plancode"},{title:"\u54C1\u79CD\u540D\u79F0",dataIndex:"name"},{title:"\u5F15\u79CD\u65B9\u5F0F",dataIndex:"method"},{title:"\u54C1\u79CD\u7C7B\u578B",dataIndex:"type"},{title:"\u662F\u5426\u5E38\u89C4",dataIndex:"isRegular"},{title:"\u4E16\u4EE3",dataIndex:"generation"},{title:"\u5F15\u79CD\u65F6\u95F4",dataIndex:"introductionTime",valueType:"dateRange",search:{transform:function(u){return{introductionTimeRange:u}}},render:function(u,n){return n.introductionTime?new Date(n.introductionTime).toLocaleDateString():"-"}},{title:"\u64AD\u79CD\u6570\u91CF",dataIndex:"sowingAmount"},{title:"\u64AD\u79CD\u65F6\u95F4",dataIndex:"sowTime",render:function(u){return u?new Date(u).toLocaleString():"-"}},{title:"\u72B6\u6001",dataIndex:"state",render:function(u,n){return n.state===1?(0,p.jsx)("span",{style:{color:"green"},children:"\u5DF2\u8003\u79CD"}):n.state===0?(0,p.jsx)("span",{style:{color:"red"},children:"\u672A\u8003\u79CD"}):(0,p.jsx)("span",{children:"-"})}},{title:"\u64CD\u4F5C",valueType:"option",render:function(u,n){return[(0,p.jsx)(j.ZP,{type:"link",disabled:n.status==="\u5DF2\u5B8C\u6210\u8003\u79CD"||n.status==="\u5DF2\u751F\u6210\u8003\u79CD\u8BB0\u5F55"||n.status==="\u5DF2\u751F\u6210\u8003\u79CD",onClick:function(){return te(n)},children:n.status==="\u5DF2\u751F\u6210\u8003\u79CD"?"\u5DF2\u751F\u6210\u8003\u79CD":n.status==="\u5DF2\u5B8C\u6210\u8003\u79CD"||n.status==="\u5DF2\u751F\u6210\u8003\u79CD\u8BB0\u5F55"?"\u79CD\u5B50\u5DF2\u8003\u79CD":"\u8003\u79CD"},"test"),(0,p.jsx)(j.ZP,{type:"link",danger:!0,onClick:function(){return ee(n)},children:"\u5220\u9664"},"delete")]}}];return(0,p.jsx)(z._z,{children:(0,p.jsx)(J.Z,{headerTitle:"\u64AD\u79CD\u8BB0\u5F55",actionRef:Q,rowKey:"key",search:{labelWidth:120},form:{onValuesChange:q},toolBarRender:function(){return[(0,p.jsx)(j.ZP,{danger:!0,icon:(0,p.jsx)(V.Z,{}),onClick:ne,disabled:D.length===0,children:"\u6279\u91CF\u5220\u9664"},"batchDelete")]},rowSelection:{selectedRowKeys:D,onChange:function(u){return I(u)}},dataSource:Y,onReset:function(){return P(h)},columns:re,pagination:{showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"],defaultPageSize:10,showTotal:function(u){return"\u5171 ".concat(u," \u6761\u8BB0\u5F55")}}})})};B.default=G}}]);
