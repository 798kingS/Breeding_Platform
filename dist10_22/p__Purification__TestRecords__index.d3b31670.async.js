"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[115],{58638:function(J,T,s){s.d(T,{Z:function(){return h}});var C=s(1413),S=s(67294),R={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 912H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32h360c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8H184v656h656V520c0-4.4 3.6-8 8-8h56c4.4 0 8 3.6 8 8v360c0 17.7-14.3 32-32 32zM770.87 199.13l-52.2-52.2a8.01 8.01 0 014.7-13.6l179.4-21c5.1-.6 9.5 3.7 8.9 8.9l-21 179.4c-.8 6.6-8.9 9.4-13.6 4.7l-52.4-52.4-256.2 256.2a8.03 8.03 0 01-11.3 0l-42.4-42.4a8.03 8.03 0 010-11.3l256.1-256.3z"}}]},name:"export",theme:"outlined"},_=R,j=s(91146),P=function(v,I){return S.createElement(j.Z,(0,C.Z)((0,C.Z)({},v),{},{ref:I,icon:_}))},M=S.forwardRef(P),h=M},9641:function(J,T,s){s.r(T);var C=s(19632),S=s.n(C),R=s(15009),_=s.n(R),j=s(97857),P=s.n(j),M=s(99289),h=s.n(M),L=s(5574),v=s.n(L),I=s(6110),H=s(29966),c=s(2453),k=s(17788),Z=s(83622),Y=s(58638),b=s(67294),V=s(27484),B=s.n(V),E=s(85893),G=function(){var Q=(0,b.useRef)(),X=(0,b.useState)([]),U=v()(X,2),p=U[0],y=U[1],q=(0,b.useState)(!1),W=v()(q,2),ee=W[0],F=W[1],te=(0,b.useState)([]),x=v()(te,2),re=x[0],ae=x[1],ne=(0,b.useState)([]),z=v()(ne,2),le=z[0],A=z[1],O=localStorage.getItem("token");(0,b.useEffect)(function(){var l=function(){var u=h()(_()().mark(function t(){var i,n,a;return _()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return F(!0),e.prev=1,e.next=4,fetch("/api/Selfing/getExamination",{headers:{Authorization:"Bearer ".concat(O)}});case 4:if(i=e.sent,i.ok){e.next=7;break}throw new Error("\u7F51\u7EDC\u9519\u8BEF");case 7:return e.next=9,i.json();case 9:n=e.sent,Array.isArray(n.data)?(a=n.data.map(function(d,r){var f,m,g;return P()(P()({},d),{},{id:(f=(m=(g=d.id)!==null&&g!==void 0?g:d.ID)!==null&&m!==void 0?m:d.key)!==null&&f!==void 0?f:r+"_"+Date.now()})}),y(a)):y([]),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(1),c.ZP.error("\u83B7\u53D6\u8003\u79CD\u8BB0\u8F7D\u8868\u6570\u636E\u5931\u8D25"),y([]);case 17:return e.prev=17,F(!1),e.finish(17);case 20:case"end":return e.stop()}},t,null,[[1,13,17,20]])}));return function(){return u.apply(this,arguments)}}();l()},[]),(0,b.useEffect)(function(){A(p)},[p]);var ue=function(u,t){var i=p,n=t.createTimeRange;if(n&&Array.isArray(n)){var a=v()(n,2),o=a[0],e=a[1];i=i.filter(function(d){var r=B()(d.createTime).valueOf();return r>=B()(o).valueOf()&&r<=B()(e).valueOf()})}Object.entries(t).forEach(function(d){var r=v()(d,2),f=r[0],m=r[1];m&&(f==="createTime"||f==="createTimeRange"||(i=i.filter(function(g){var K;return((K=g[f])!==null&&K!==void 0?K:"").toString().includes(m)})))}),A(i)},se=function(){var l=h()(_()().mark(function u(t){var i,n,a;return _()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("/api/Selfing/editexamination",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(O)},body:JSON.stringify(t)});case 3:return i=e.sent,e.next=6,i.json();case 6:if(n=e.sent,!(i.ok&&n.success!==!1)){e.next=14;break}return a=p.map(function(d){return d.id===t.id?P()(P()({},d),t):d}),y(a),c.ZP.success("\u4FDD\u5B58\u6210\u529F"),e.abrupt("return",!0);case 14:return c.ZP.error(n.message||"\u4FDD\u5B58\u5931\u8D25"),e.abrupt("return",!1);case 16:e.next=22;break;case 18:return e.prev=18,e.t0=e.catch(0),c.ZP.error("\u4FDD\u5B58\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5"),e.abrupt("return",!1);case 22:case"end":return e.stop()}},u,null,[[0,18]])}));return function(t){return l.apply(this,arguments)}}(),ie=function(u){k.Z.confirm({title:"\u786E\u8BA4\u5220\u9664",content:"\u786E\u5B9A\u8981\u5220\u9664\u8FD9\u6761\u8BB0\u5F55\u5417\uFF1F",onOk:function(){var t=h()(_()().mark(function n(){var a,o,e;return _()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,fetch("/api/Selfing/editexaminationdelete?plantid=".concat(u.plantingCode),{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(O)},body:JSON.stringify({id:u.id})});case 3:return a=r.sent,r.next=6,a.json();case 6:o=r.sent,a.ok&&o.success!==!1?(e=p.filter(function(f){return f.id!==u.id}),y(e),c.ZP.success("\u5220\u9664\u6210\u529F")):c.ZP.error(o.message||"\u5220\u9664\u5931\u8D25"),r.next=13;break;case 10:r.prev=10,r.t0=r.catch(0),c.ZP.error("\u5220\u9664\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5");case 13:case"end":return r.stop()}},n,null,[[0,10]])}));function i(){return t.apply(this,arguments)}return i}()})},oe=(0,b.useState)([]),$=v()(oe,2),D=$[0],N=$[1],de=function(){if(D.length===0){c.ZP.warning("\u8BF7\u9009\u62E9\u8981\u5220\u9664\u7684\u8BB0\u5F55");return}k.Z.confirm({title:"\u786E\u8BA4\u5220\u9664",content:"\u786E\u5B9A\u8981\u5220\u9664\u9009\u4E2D\u7684 ".concat(D.length," \u6761\u8BB0\u5F55\u5417\uFF1F"),onOk:function(){var u=h()(_()().mark(function i(){var n,a,o,e;return _()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,n=D.map(function(f){var m=p.find(function(g){return g.id===f});return m==null?void 0:m.plantingCode}).filter(Boolean),r.next=4,fetch("/api/Selfing/BatchDeleteExamination",{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(O)},body:JSON.stringify({keys:n})});case 4:return a=r.sent,r.next=7,a.json();case 7:o=r.sent,a.ok&&o.success!==!1?(e=p.filter(function(f){return!D.includes(f.id)}),y(e),N([]),c.ZP.success("\u6279\u91CF\u5220\u9664\u6210\u529F")):c.ZP.error(o.message||"\u6279\u91CF\u5220\u9664\u5931\u8D25"),r.next=14;break;case 11:r.prev=11,r.t0=r.catch(0),c.ZP.error("\u6279\u91CF\u5220\u9664\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5");case 14:case"end":return r.stop()}},i,null,[[0,11]])}));function t(){return u.apply(this,arguments)}return t}()})},ce=function(){var l=h()(_()().mark(function u(t){var i,n,a;return _()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,i={plantingCode:t.plantingCode,code:t.code,varietyName:t.varietyName,method:t.method,type:t.type,isRegular:t.isRegular,generation:t.generation,amount:t.amount||1,saveTime:new Date().toISOString(),source:t.source||"",key:t.id||Date.now()+Math.random()},e.next=4,fetch("/api/Selfing/reserve",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(O)},body:JSON.stringify(i)});case 4:return n=e.sent,e.next=7,n.json();case 7:a=e.sent,n.ok&&a.success!==!1?c.ZP.success("\u7559\u79CD\u6210\u529F"):c.ZP.error(a.message||"\u7559\u79CD\u5931\u8D25"),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),c.ZP.error("\u7559\u79CD\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5");case 14:case"end":return e.stop()}},u,null,[[0,11]])}));return function(t){return l.apply(this,arguments)}}(),w=[{title:"\u7CFB\u8C31\u7F16\u53F7",dataIndex:"plantingCode",valueType:"text",fieldProps:{placeholder:"\u8BF7\u8F93\u5165\u7CFB\u8C31\u7F16\u53F7"},copyable:!0,editable:function(){return!0}},{title:"\u7F16\u53F7",dataIndex:"code",valueType:"text",fieldProps:{placeholder:"\u8BF7\u8F93\u5165\u7F16\u53F7"},copyable:!0,editable:function(){return!0}},{title:"\u54C1\u79CD\u540D\u79F0",dataIndex:"varietyName",valueType:"text",fieldProps:{placeholder:"\u8BF7\u8F93\u5165\u54C1\u79CD\u540D\u79F0"},editable:function(){return!0}},{title:"\u5F15\u79CD\u65B9\u5F0F",dataIndex:"method",valueType:"text",fieldProps:{placeholder:"\u8BF7\u8F93\u5165\u5F15\u79CD\u65B9\u5F0F"},editable:function(){return!0}},{title:"\u54C1\u79CD\u7C7B\u578B",dataIndex:"type",valueType:"text",fieldProps:{placeholder:"\u8BF7\u8F93\u5165\u54C1\u79CD\u7C7B\u578B"},editable:function(){return!0}},{title:"\u662F\u5426\u5E38\u89C4",dataIndex:"isRegular",valueType:"text",fieldProps:{placeholder:"\u8BF7\u8F93\u5165\u662F\u5426\u5E38\u89C4"},valueEnum:{true:{text:"\u662F",status:"Success"},false:{text:"\u5426",status:"Error"}},editable:function(){return!0}},{title:"\u4E16\u4EE3",dataIndex:"generation",valueType:"text",fieldProps:{placeholder:"\u8BF7\u8F93\u5165\u4E16\u4EE3"},editable:function(){return!0}},{title:"\u6570\u91CF",dataIndex:"generateCount",valueType:"digit",fieldProps:{placeholder:"\u8BF7\u8F93\u5165\u6570\u91CF"},editable:function(){return!0}},{title:"\u8003\u79CD\u65F6\u95F4",dataIndex:"createTime",valueType:"dateTimeRange",editable:!1,search:{transform:function(u){return{createTimeRange:u}}},render:function(u,t){return t.createTime?B()(t.createTime).format("YYYY-MM-DD HH:mm:ss"):"-"},fieldProps:{placeholder:"\u8BF7\u9009\u62E9\u8003\u79CD\u65F6\u95F4"}},{title:"\u6765\u6E90",dataIndex:"source",valueType:"text",fieldProps:{placeholder:"\u8BF7\u8F93\u5165\u6765\u6E90"},editable:function(){return!0}},{title:"\u64CD\u4F5C",valueType:"option",key:"option",hideInSearch:!0,render:function(u,t,i,n){return[(0,E.jsx)("a",{onClick:function(){var o;return n==null||(o=n.startEditable)===null||o===void 0?void 0:o.call(n,t.id)},children:"\u7F16\u8F91"},"edit"),(0,E.jsx)("a",{onClick:function(){return ie(t)},children:"\u5220\u9664"},"delete"),(0,E.jsx)("a",{onClick:function(){return ce(t)},children:"\u7559\u79CD"},"saveSeed")]}}],_e=function(){if(p.length===0){c.ZP.warning("\u6682\u65E0\u6570\u636E\u53EF\u5BFC\u51FA");return}var u=w.filter(function(e){return e.dataIndex&&e.dataIndex!=="option"}).map(function(e){return e.dataIndex}),t=w.filter(function(e){return e.dataIndex&&e.dataIndex!=="option"}).map(function(e){return e.title}),i=[t.join(",")].concat(S()(p.map(function(e){return u.map(function(d){var r;return(r=e[d])!==null&&r!==void 0?r:""}).join(",")}))).join(`
`),n=new Blob(["\uFEFF"+i],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a"),o=URL.createObjectURL(n);a.setAttribute("href",o),a.setAttribute("download","\u8003\u79CD\u8BB0\u8F7D\u8868.csv"),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a)};return(0,E.jsx)(I._z,{children:(0,E.jsx)(H.Z,{headerTitle:"\u8003\u79CD\u8BB0\u8F7D\u8868",actionRef:Q,rowKey:"id",dataSource:le,onReset:function(){return A(p)},search:{labelWidth:90,defaultCollapsed:!0,collapseRender:function(u){return u?"\u5C55\u5F00 \u2228":"\u6536\u8D77 \u2227"},filterType:"query"},form:{syncToUrl:!1,onValuesChange:ue},toolBarRender:function(){return[(0,E.jsx)(Z.ZP,{type:"primary",onClick:_e,icon:(0,E.jsx)(Y.Z,{}),children:"\u5BFC\u51FA"},"export"),(0,E.jsx)(Z.ZP,{danger:!0,onClick:de,disabled:D.length===0,children:"\u6279\u91CF\u5220\u9664"},"batchDelete")]},columns:w,loading:ee,rowSelection:{selectedRowKeys:D,onChange:function(u){return N(u)}},editable:{type:"single",editableKeys:re,onSave:function(){var l=h()(_()().mark(function t(i,n){return _()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",se(n));case 1:case"end":return o.stop()}},t)}));function u(t,i){return l.apply(this,arguments)}return u}(),onChange:ae},pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:function(u){return"\u5171 ".concat(u," \u6761\u8BB0\u5F55")}}})})};T.default=G}}]);
