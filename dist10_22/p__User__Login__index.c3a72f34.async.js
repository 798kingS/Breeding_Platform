"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[366],{27076:function(sr,le,l){l.r(le),l.d(le,{default:function(){return rr}});var be=l(97857),L=l.n(be),Se=l(15009),p=l.n(Se),Me=l(99289),A=l.n(Me),Ce=l(5574),T=l.n(Ce),Ie=l(97176),b=l(76772);function Ae(e,s){return K.apply(this,arguments)}function K(){return K=A()(p()().mark(function e(s,u){return p()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,b.request)("/api/login/captcha",L()({method:"GET",params:L()({},s)},u||{})));case 1:case"end":return a.stop()}},e)})),K.apply(this,arguments)}var Pe=l(38123),Le=l(71356),Fe=l(88777),ce=l(87547),N=l(94149),je=l(24454),Ze=l(68262),X=l(5966),Ue=l(16434),Be=l(63434),de=l(40056),W=l(8232),f=l(2453),Ee=l(17788),ge=l(83622),_=l(55102),Qe=l(11941),Re=l(67610),Z=l(67294),G=l(73935),Te=l(28846),D=l(27196),$={appId:"101234567",redirectUri:encodeURIComponent(window.location.origin+"/login/qq/callback"),scope:"get_user_info"};function $e(){var e=new URLSearchParams({response_type:"code",client_id:$.appId,redirect_uri:$.redirectUri,scope:$.scope,state:Math.random().toString(36).substring(2,15)});return"https://graph.qq.com/oauth2.0/authorize?".concat(e.toString())}function qe(){var e=new URLSearchParams(window.location.search);return e.get("code")}function We(e){return ee.apply(this,arguments)}function ee(){return ee=A()(p()().mark(function e(s){var u,m,a,P,t,g;return p()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.prev=0,v.next=3,fetch("https://graph.qq.com/oauth2.0/token?grant_type=authorization_code&client_id=".concat($.appId,"&client_secret=YOUR_CLIENT_SECRET&code=").concat(s,"&redirect_uri=").concat($.redirectUri),{method:"GET"});case 3:return u=v.sent,v.next=6,u.text();case 6:if(m=v.sent,a=new URLSearchParams(m),P=a.get("access_token"),t=a.get("expires_in"),g=a.get("refresh_token"),!P){v.next=13;break}return v.abrupt("return",{access_token:P,expires_in:parseInt(t||"0"),refresh_token:g||""});case 13:return v.abrupt("return",null);case 16:return v.prev=16,v.t0=v.catch(0),console.error("\u83B7\u53D6QQ Access Token\u5931\u8D25:",v.t0),v.abrupt("return",null);case 20:case"end":return v.stop()}},e,null,[[0,16]])})),ee.apply(this,arguments)}function De(e){return re.apply(this,arguments)}function re(){return re=A()(p()().mark(function e(s){var u,m,a,P;return p()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.prev=0,g.next=3,fetch("https://graph.qq.com/oauth2.0/me?access_token=".concat(s),{method:"GET"});case 3:return u=g.sent,g.next=6,u.text();case 6:if(m=g.sent,a=m.match(/callback\((.+)\)/),!a){g.next=11;break}return P=JSON.parse(a[1]),g.abrupt("return",P.openid);case 11:return g.abrupt("return",null);case 14:return g.prev=14,g.t0=g.catch(0),console.error("\u83B7\u53D6QQ OpenID\u5931\u8D25:",g.t0),g.abrupt("return",null);case 18:case"end":return g.stop()}},e,null,[[0,14]])})),re.apply(this,arguments)}function Oe(e,s){return ae.apply(this,arguments)}function ae(){return ae=A()(p()().mark(function e(s,u){var m,a;return p()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch("https://graph.qq.com/user/get_user_info?access_token=".concat(s,"&oauth_consumer_key=").concat($.appId,"&openid=").concat(u),{method:"GET"});case 3:return m=t.sent,t.next=6,m.json();case 6:if(a=t.sent,a.ret!==0){t.next=9;break}return t.abrupt("return",a);case 9:return t.abrupt("return",null);case 12:return t.prev=12,t.t0=t.catch(0),console.error("\u83B7\u53D6QQ\u7528\u6237\u4FE1\u606F\u5931\u8D25:",t.t0),t.abrupt("return",null);case 16:case"end":return t.stop()}},e,null,[[0,12]])})),ae.apply(this,arguments)}function ze(){var e=$e();window.location.href=e}function Ne(){return se.apply(this,arguments)}function se(){return se=A()(p()().mark(function e(){var s,u,m,a;return p()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(s=qe(),s){t.next=3;break}return t.abrupt("return",null);case 3:return t.next=5,We(s);case 5:if(u=t.sent,u){t.next=8;break}return t.abrupt("return",null);case 8:return t.next=10,De(u.access_token);case 10:if(m=t.sent,m){t.next=13;break}return t.abrupt("return",null);case 13:return t.next=15,Oe(u.access_token,m);case 15:if(a=t.sent,a){t.next=18;break}return t.abrupt("return",null);case 18:return t.abrupt("return",{accessToken:u.access_token,openId:m,userInfo:a});case 19:case"end":return t.stop()}},e)})),se.apply(this,arguments)}var U={appId:"wx1234567890abcdef",redirectUri:encodeURIComponent(window.location.origin+"/login/wechat/callback"),scope:"snsapi_userinfo",state:"wechat_login_"+Math.random().toString(36).substring(2,15)};function Ge(){var e=new URLSearchParams({appid:U.appId,redirect_uri:U.redirectUri,response_type:"code",scope:U.scope,state:U.state});return"https://open.weixin.qq.com/connect/qrconnect?".concat(e.toString(),"#wechat_redirect")}function pe(){var e=new URLSearchParams(window.location.search);return e.get("code")}function me(){var e=new URLSearchParams(window.location.search);return e.get("state")}function xe(){var e=pe(),s=me();return!!(e&&s&&s.startsWith("wechat_login_"))}function fe(){var e=Ge();window.location.href=e}function Ve(){return te.apply(this,arguments)}function te(){return te=A()(p()().mark(function e(){var s,u;return p()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(s=pe(),u=me(),!(!s||!u)){a.next=4;break}return a.abrupt("return",null);case 4:if(u.startsWith("wechat_login_")){a.next=7;break}return console.error("Invalid state parameter"),a.abrupt("return",null);case 7:return a.abrupt("return",{code:s,state:u});case 8:case"end":return a.stop()}},e)})),te.apply(this,arguments)}function he(){var e=navigator.userAgent.toLowerCase();return e.includes("micromessenger")}function tr(){if(!he()){console.warn("Not in WeChat browser, using QR code login"),fe();return}var e=new URLSearchParams({appid:U.appId,redirect_uri:U.redirectUri,response_type:"code",scope:"snsapi_base",state:U.state}),s="https://open.weixin.qq.com/connect/oauth2/authorize?".concat(e.toString(),"#wechat_redirect");window.location.href=s}function nr(){return _objectSpread(_objectSpread({},U),{},{isWechatBrowser:he()})}var B={appId:"2021001234567890",redirectUri:encodeURIComponent(window.location.origin+"/login/alipay/callback"),scope:"auth_user",state:"alipay_login_"+Math.random().toString(36).substring(2,15)};function He(){var e=new URLSearchParams({app_id:B.appId,redirect_uri:B.redirectUri,scope:B.scope,state:B.state});return"https://openauth.alipay.com/oauth2/publicAppAuthorize.htm?".concat(e.toString())}function ve(){var e=new URLSearchParams(window.location.search);return e.get("auth_code")}function ye(){var e=new URLSearchParams(window.location.search);return e.get("state")}function Ye(){var e=ve(),s=ye();return!!(e&&s&&s.startsWith("alipay_login_"))}function ke(){var e=He();window.location.href=e}function Je(){return ne.apply(this,arguments)}function ne(){return ne=A()(p()().mark(function e(){var s,u;return p()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(s=ve(),u=ye(),!(!s||!u)){a.next=4;break}return a.abrupt("return",null);case 4:if(u.startsWith("alipay_login_")){a.next=7;break}return console.error("Invalid state parameter"),a.abrupt("return",null);case 7:return a.abrupt("return",{authCode:s,state:u});case 8:case"end":return a.stop()}},e)})),ne.apply(this,arguments)}function ie(){var e=navigator.userAgent.toLowerCase();return e.includes("alipay")||e.includes("alipayclient")}function ir(){if(!ie()){console.warn("Not in Alipay browser, using web login"),ke();return}var e=new URLSearchParams({app_id:B.appId,redirect_uri:B.redirectUri,scope:"auth_base",state:B.state}),s="https://openauth.alipay.com/oauth2/publicAppAuthorize.htm?".concat(e.toString());window.location.href=s}function or(){return _objectSpread(_objectSpread({},B),{},{isAlipayBrowser:ie()})}function ur(){var e=ie();return{isAlipayBrowser:e,canUseSilentAuth:e,recommendedMethod:e?"silent":"web"}}var r=l(85893),oe=(0,Te.kc)(function(e){var s=e.token;return{action:{marginLeft:"8px",color:"rgba(0, 0, 0, 0.2)",fontSize:"24px",verticalAlign:"middle",cursor:"pointer",transition:"all 0.3s","&:hover":{color:s.colorPrimaryActive,transform:"scale(1.1)"}},qqIcon:{marginLeft:"8px",color:"#12B7F5",fontSize:"24px",verticalAlign:"middle",cursor:"pointer",transition:"all 0.3s","&:hover":{color:"#0A9BD9",transform:"scale(1.1)"}},wechatIcon:{marginLeft:"8px",color:"#07C160",fontSize:"24px",verticalAlign:"middle",cursor:"pointer",transition:"all 0.3s","&:hover":{color:"#06AD56",transform:"scale(1.1)"}},alipayIcon:{marginLeft:"8px",color:"#1677FF",fontSize:"24px",verticalAlign:"middle",cursor:"pointer",transition:"all 0.3s","&:hover":{color:"#0958D9",transform:"scale(1.1)"}},lang:{width:42,height:42,lineHeight:"42px",position:"fixed",right:16,borderRadius:s.borderRadius,":hover":{backgroundColor:s.colorBgTextHover}},container:{display:"flex",flexDirection:"column",height:"100vh",overflow:"auto",backgroundImage:"url('https://mdn.alipayobjects.com/yuyan_qk0oxh/afts/img/V-_oS6r-i7wAAAAAAAAAAAAAFl94AQBr')",backgroundSize:"100% 100%"},registerLink:{display:"block",textAlign:"center",marginTop:16,color:s.colorPrimary,fontWeight:500,cursor:"pointer","&:hover":{color:s.colorPrimaryHover}}}}),Ke=function(){var s=oe(),u=s.styles,m=function(P){switch(P){case"qq":ze();break;case"wechat":fe();break;case"alipay":ke();break;default:break}};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(Pe.Z,{className:u.qqIcon,title:"QQ\u767B\u5F55",onClick:function(){return m("qq")}},"QqOutlined"),(0,r.jsx)(Le.Z,{className:u.wechatIcon,title:"\u5FAE\u4FE1\u767B\u5F55",onClick:function(){return m("wechat")}},"WechatOutlined"),(0,r.jsx)(Fe.Z,{className:u.alipayIcon,title:"\u652F\u4ED8\u5B9D\u767B\u5F55",onClick:function(){return m("alipay")}},"AlipayCircleOutlined")]})},Xe=function(){var s=oe(),u=s.styles;return(0,r.jsx)("div",{className:u.lang,"data-lang":!0,children:b.SelectLang&&(0,r.jsx)(b.SelectLang,{})})},we=function(s){var u=s.content;return(0,r.jsx)(de.Z,{style:{marginBottom:24},message:u,type:"error",showIcon:!0})},_e=function(s){var u=s.visible,m=s.onCancel,a=s.onSuccess,P=W.Z.useForm(),t=T()(P,1),g=t[0],x=(0,Z.useState)(!1),v=T()(x,2),V=v[0],H=v[1],Y=(0,Z.useState)(null),J=T()(Y,2),j=J[0],E=J[1],k=(0,b.useIntl)(),M=function(){var O=A()(p()().mark(function Q(){var z,q,h;return p()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,H(!0),E(null),o.next=5,g.validateFields();case 5:return z=o.sent,o.next=8,(0,D.z2)(z);case 8:q=o.sent,q.success?(f.ZP.success(k.formatMessage({id:"pages.register.success",defaultMessage:"\u6CE8\u518C\u6210\u529F\uFF01"})),g.resetFields(),a(),m()):E(q.message||"\u6CE8\u518C\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5"),o.next=15;break;case 12:o.prev=12,o.t0=o.catch(0),(h=o.t0.response)!==null&&h!==void 0&&(h=h.data)!==null&&h!==void 0&&h.message?E(o.t0.response.data.message):o.t0.message?E(o.t0.message):E(k.formatMessage({id:"pages.register.failure",defaultMessage:"\u6CE8\u518C\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5"}));case 15:return o.prev=15,H(!1),o.finish(15);case 18:case"end":return o.stop()}},Q,null,[[0,12,15,18]])}));return function(){return O.apply(this,arguments)}}();return(0,r.jsx)(Ee.Z,{title:k.formatMessage({id:"menu.register",defaultMessage:"\u7528\u6237\u6CE8\u518C"}),open:u,onCancel:m,footer:[(0,r.jsx)(ge.ZP,{onClick:m,children:k.formatMessage({id:"pages.register.cancel",defaultMessage:"\u53D6\u6D88"})},"back"),(0,r.jsx)(ge.ZP,{type:"primary",loading:V,onClick:M,children:k.formatMessage({id:"pages.register.submit",defaultMessage:"\u6CE8\u518C"})},"submit")],children:(0,r.jsxs)(W.Z,{form:g,layout:"vertical",children:[j&&(0,r.jsx)(de.Z,{message:j,type:"error",showIcon:!0,style:{marginBottom:24}}),(0,r.jsx)(W.Z.Item,{name:"username",label:k.formatMessage({id:"pages.register.username",defaultMessage:"\u7528\u6237\u540D"}),rules:[{required:!0,message:k.formatMessage({id:"pages.register.username.required",defaultMessage:"\u8BF7\u8F93\u5165\u7528\u6237\u540D!"})},{min:4,message:k.formatMessage({id:"pages.register.username.min",defaultMessage:"\u7528\u6237\u540D\u81F3\u5C114\u4E2A\u5B57\u7B26!"})}],children:(0,r.jsx)(_.Z,{prefix:(0,r.jsx)(ce.Z,{}),placeholder:k.formatMessage({id:"pages.register.username.placeholder",defaultMessage:"\u8BF7\u8F93\u5165\u7528\u6237\u540D"})})}),(0,r.jsx)(W.Z.Item,{name:"password",label:k.formatMessage({id:"pages.register.password",defaultMessage:"\u5BC6\u7801"}),rules:[{required:!0,message:k.formatMessage({id:"pages.register.password.required",defaultMessage:"\u8BF7\u8F93\u5165\u5BC6\u7801!"})},{min:6,message:k.formatMessage({id:"pages.register.password.min",defaultMessage:"\u5BC6\u7801\u81F3\u5C116\u4E2A\u5B57\u7B26!"})}],children:(0,r.jsx)(_.Z.Password,{prefix:(0,r.jsx)(N.Z,{}),placeholder:k.formatMessage({id:"pages.register.password.placeholder",defaultMessage:"\u8BF7\u8F93\u5165\u5BC6\u7801"})})}),(0,r.jsx)(W.Z.Item,{name:"confirmPassword",label:k.formatMessage({id:"pages.register.confirmPassword",defaultMessage:"\u786E\u8BA4\u5BC6\u7801"}),dependencies:["password"],rules:[{required:!0,message:k.formatMessage({id:"pages.register.confirmPassword.required",defaultMessage:"\u8BF7\u786E\u8BA4\u5BC6\u7801!"})},function(O){var Q=O.getFieldValue;return{validator:function(q,h){return!h||Q("password")===h?Promise.resolve():Promise.reject(new Error(k.formatMessage({id:"pages.register.confirmPassword.mismatch",defaultMessage:"\u4E24\u6B21\u8F93\u5165\u7684\u5BC6\u7801\u4E0D\u5339\u914D!"})))}}}],children:(0,r.jsx)(_.Z.Password,{prefix:(0,r.jsx)(N.Z,{}),placeholder:k.formatMessage({id:"pages.register.confirmPassword.placeholder",defaultMessage:"\u8BF7\u518D\u6B21\u8F93\u5165\u5BC6\u7801"})})})]})})},er=function(){var s=(0,Z.useState)({}),u=T()(s,2),m=u[0],a=u[1],P=(0,Z.useState)("account"),t=T()(P,2),g=t[0],x=t[1],v=(0,Z.useState)(!1),V=T()(v,2),H=V[0],Y=V[1],J=(0,b.useModel)("@@initialState"),j=J.setInitialState,E=oe(),k=E.styles,M=(0,b.useIntl)();(0,Z.useEffect)(function(){var h=function(){var C=A()(p()().mark(function o(){var d,i,y,w,S,n,F,I;return p()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(d=new URLSearchParams(window.location.search),i=d.get("code"),y=d.get("state"),!(i&&y)){c.next=30;break}return c.prev=4,f.ZP.loading("\u6B63\u5728\u5904\u7406QQ\u767B\u5F55...",0),c.next=8,Ne();case 8:if(w=c.sent,!w){c.next=22;break}return c.next=12,(0,D.GT)({accessToken:w.accessToken,openId:w.openId,userInfo:w.userInfo});case 12:S=c.sent,S.token&&(localStorage.setItem("token",S.token),localStorage.setItem("userId",((n=S.id)===null||n===void 0?void 0:n.toString())||""),localStorage.setItem("userRole",S.role||""),(S.username||(F=w.userInfo)!==null&&F!==void 0&&F.nickname)&&localStorage.setItem("username",S.username||w.userInfo.nickname||"")),a({status:"ok",type:"qq",token:S.token,id:S.id,username:S.username||w.userInfo.nickname,role:S.role}),(0,G.flushSync)(function(){j(function(ue){var R;return L()(L()({},ue),{},{currentUser:{name:S.username||w.userInfo.nickname||"QQ\u7528\u6237",avatar:w.userInfo.figureurl_qq_2||w.userInfo.figureurl_qq_1||"https://breed-1258140596.cos.ap-shanghai.myqcloud.com/%E7%A7%8D%E8%B4%A8%E8%B5%84%E6%BA%90/tx.png",userid:((R=S.id)===null||R===void 0?void 0:R.toString())||"00000002",email:"qq@example.com",signature:"\u4E13\u6CE8\u79CD\u690D\uFF0C\u7528\u5FC3\u57F9\u80B2",title:"\u79CD\u690D\u4E13\u5BB6",group:"\u80B2\u79CD\u5E73\u53F0\uFF0D\u5F00\u53D1\u90E8\u95E8",tags:[{key:"0",label:"\u79CD\u690D\u8FBE\u4EBA"}],notifyCount:5,unreadCount:3,country:"China",access:S.role||"user",geographic:{province:{label:"\u6D59\u6C5F\u7701",key:"330000"},city:{label:"\u6E56\u5DDE\u5E02",key:"330500"}},address:"\u6E56\u5DDE\u5E02\u5434\u5174\u533A",phone:"0572-12345678"}})})}),f.ZP.destroy(),f.ZP.success("QQ\u767B\u5F55\u6210\u529F\uFF01"),I=new URL(window.location.href).searchParams,b.history.push(I.get("redirect")||"/"),c.next=24;break;case 22:f.ZP.destroy(),f.ZP.error("QQ\u767B\u5F55\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5");case 24:c.next=30;break;case 26:c.prev=26,c.t0=c.catch(4),f.ZP.destroy(),f.ZP.error("QQ\u767B\u5F55\u5931\u8D25\uFF1A"+(c.t0.message||"\u672A\u77E5\u9519\u8BEF"));case 30:case"end":return c.stop()}},o,null,[[4,26]])}));return function(){return C.apply(this,arguments)}}();h()},[j]),(0,Z.useEffect)(function(){var h=function(){var C=A()(p()().mark(function o(){var d,i,y,w;return p()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!xe()){n.next=27;break}return n.prev=1,f.ZP.loading("\u6B63\u5728\u5904\u7406\u5FAE\u4FE1\u767B\u5F55...",0),n.next=5,Ve();case 5:if(d=n.sent,!d){n.next=19;break}return n.next=9,(0,D.Hx)({code:d.code,state:d.state});case 9:i=n.sent,i.token&&(localStorage.setItem("token",i.token),localStorage.setItem("userId",((y=i.id)===null||y===void 0?void 0:y.toString())||""),localStorage.setItem("userRole",i.role||""),localStorage.setItem("username",i.username||"\u5FAE\u4FE1\u7528\u6237")),a({status:"ok",type:"wechat",token:i.token,id:i.id,username:i.username||"\u5FAE\u4FE1\u7528\u6237",role:i.role}),(0,G.flushSync)(function(){j(function(F){var I;return L()(L()({},F),{},{currentUser:{name:i.username||"\u5FAE\u4FE1\u7528\u6237",avatar:"https://breed-1258140596.cos.ap-shanghai.myqcloud.com/%E7%A7%8D%E8%B4%A5%E8%B5%84%E6%BA%90/tx.png",userid:((I=i.id)===null||I===void 0?void 0:I.toString())||"00000003",email:"wechat@example.com",signature:"\u4E13\u6CE8\u79CD\u690D\uFF0C\u7528\u5FC3\u57F9\u80B2",title:"\u79CD\u690D\u4E13\u5BB6",group:"\u80B2\u79CD\u5E73\u53F0\uFF0D\u5F00\u53D1\u90E8\u95E8",tags:[{key:"0",label:"\u79CD\u690D\u8FBE\u4EBA"}],notifyCount:5,unreadCount:3,country:"China",access:i.role||"user",geographic:{province:{label:"\u6D59\u6C5F\u7701",key:"330000"},city:{label:"\u6E56\u5DDE\u5E02",key:"330500"}},address:"\u6E56\u5DDE\u5E02\u5434\u5174\u533A",phone:"0572-12345678"}})})}),f.ZP.destroy(),f.ZP.success("\u5FAE\u4FE1\u767B\u5F55\u6210\u529F\uFF01"),w=new URL(window.location.href).searchParams,b.history.push(w.get("redirect")||"/"),n.next=21;break;case 19:f.ZP.destroy(),f.ZP.error("\u5FAE\u4FE1\u767B\u5F55\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5");case 21:n.next=27;break;case 23:n.prev=23,n.t0=n.catch(1),f.ZP.destroy(),f.ZP.error("\u5FAE\u4FE1\u767B\u5F55\u5931\u8D25\uFF1A"+(n.t0.message||"\u672A\u77E5\u9519\u8BEF"));case 27:case"end":return n.stop()}},o,null,[[1,23]])}));return function(){return C.apply(this,arguments)}}();h()},[j]),(0,Z.useEffect)(function(){var h=function(){var C=A()(p()().mark(function o(){var d,i,y,w;return p()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!Ye()){n.next=27;break}return n.prev=1,f.ZP.loading("\u6B63\u5728\u5904\u7406\u652F\u4ED8\u5B9D\u767B\u5F55...",0),n.next=5,Je();case 5:if(d=n.sent,!d){n.next=19;break}return n.next=9,(0,D.gZ)({authCode:d.authCode,state:d.state});case 9:i=n.sent,i.token&&(localStorage.setItem("token",i.token),localStorage.setItem("userId",((y=i.id)===null||y===void 0?void 0:y.toString())||""),localStorage.setItem("userRole",i.role||""),localStorage.setItem("username",i.username||"\u652F\u4ED8\u5B9D\u7528\u6237")),a({status:"ok",type:"alipay",token:i.token,id:i.id,username:i.username||"\u652F\u4ED8\u5B9D\u7528\u6237",role:i.role}),(0,G.flushSync)(function(){j(function(F){var I;return L()(L()({},F),{},{currentUser:{name:i.username||"\u652F\u4ED8\u5B9D\u7528\u6237",avatar:"https://breed-1258140596.cos.ap-shanghai.myqcloud.com/%E7%A7%8D%E8%B4%A5%E8%B5%84%E6%BA%90/tx.png",userid:((I=i.id)===null||I===void 0?void 0:I.toString())||"00000004",email:"alipay@example.com",signature:"\u4E13\u6CE8\u79CD\u690D\uFF0C\u7528\u5FC3\u57F9\u80B2",title:"\u79CD\u690D\u4E13\u5BB6",group:"\u80B2\u79CD\u5E73\u53F0\uFF0D\u5F00\u53D1\u90E8\u95E8",tags:[{key:"0",label:"\u79CD\u690D\u8FBE\u4EBA"}],notifyCount:5,unreadCount:3,country:"China",access:i.role||"user",geographic:{province:{label:"\u6D59\u6C5F\u7701",key:"330000"},city:{label:"\u6E56\u5DDE\u5E02",key:"330500"}},address:"\u6E56\u5DDE\u5E02\u5434\u5174\u533A",phone:"0572-12345678"}})})}),f.ZP.destroy(),f.ZP.success("\u652F\u4ED8\u5B9D\u767B\u5F55\u6210\u529F\uFF01"),w=new URL(window.location.href).searchParams,b.history.push(w.get("redirect")||"/"),n.next=21;break;case 19:f.ZP.destroy(),f.ZP.error("\u652F\u4ED8\u5B9D\u767B\u5F55\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5");case 21:n.next=27;break;case 23:n.prev=23,n.t0=n.catch(1),f.ZP.destroy(),f.ZP.error("\u652F\u4ED8\u5B9D\u767B\u5F55\u5931\u8D25\uFF1A"+(n.t0.message||"\u672A\u77E5\u9519\u8BEF"));case 27:case"end":return n.stop()}},o,null,[[1,23]])}));return function(){return C.apply(this,arguments)}}();h()},[j]);var O=function(){var h=A()(p()().mark(function C(o){var d,i,y,w,S,n,F,I;return p()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.prev=0,c.next=3,(0,D.x4)(L()(L()({},o),{},{type:g}));case 3:return d=c.sent,d.token&&(localStorage.setItem("token",d.token),localStorage.setItem("userId",((i=d.id)===null||i===void 0?void 0:i.toString())||""),localStorage.setItem("userRole",d.role||""),(d.username||o.username)&&localStorage.setItem("username",d.username||o.username||"")),a({status:"ok",type:g,token:d.token,id:d.id,username:d.username,role:d.role}),(0,G.flushSync)(function(){j(function(ue){var R;return L()(L()({},ue),{},{currentUser:{name:d.username||o.username||"User",avatar:"https://breed-1258140596.cos.ap-shanghai.myqcloud.com/%E7%A7%8D%E8%B4%A8%E8%B5%84%E6%BA%90/tx.png",userid:((R=d.id)===null||R===void 0?void 0:R.toString())||"00000002",email:"2104170424@qq.com",signature:"\u4E13\u6CE8\u79CD\u690D\uFF0C\u7528\u5FC3\u57F9\u80B2",title:"\u79CD\u690D\u4E13\u5BB6",group:"\u80B2\u79CD\u5E73\u53F0\uFF0D\u5F00\u53D1\u90E8\u95E8",tags:[{key:"0",label:"\u79CD\u690D\u8FBE\u4EBA"}],notifyCount:5,unreadCount:3,country:"China",access:d.role||"user",geographic:{province:{label:"\u6D59\u6C5F\u7701",key:"330000"},city:{label:"\u6E56\u5DDE\u5E02",key:"330500"}},address:"\u6E56\u5DDE\u5E02\u5434\u5174\u533A",phone:"0572-12345678"}})})}),y=M.formatMessage({id:"pages.login.success",defaultMessage:"\u767B\u5F55\u6210\u529F\uFF01"}),f.ZP.success(y),w=new URL(window.location.href).searchParams,b.history.push(w.get("redirect")||"/"),c.abrupt("return");case 14:c.prev=14,c.t0=c.catch(0),S=M.formatMessage({id:"pages.login.failure",defaultMessage:"\u767B\u5F55\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5\uFF01"}),n=S,c.t0.name==="AxiosError"?((F=c.t0.response)===null||F===void 0?void 0:F.status)===401?n=M.formatMessage({id:"pages.login.unauthorized",defaultMessage:"\u7528\u6237\u540D\u6216\u5BC6\u7801\u9519\u8BEF"}):(I=c.t0.response)!==null&&I!==void 0&&(I=I.data)!==null&&I!==void 0&&I.message&&(n=c.t0.response.data.message):c.t0.message&&(n=c.t0.message),f.ZP.error(n),a({status:"error",type:g,message:n});case 21:case"end":return c.stop()}},C,null,[[0,14]])}));return function(o){return h.apply(this,arguments)}}(),Q=m.status,z=m.type,q=m.message;return(0,r.jsxs)("div",{className:k.container,children:[(0,r.jsx)(b.Helmet,{children:(0,r.jsxs)("title",{children:[M.formatMessage({id:"menu.login",defaultMessage:"\u767B\u5F55\u9875"}),"- ",Re.Z.title]})}),(0,r.jsx)(Xe,{}),(0,r.jsx)("div",{style:{flex:"1",padding:"32px 0"},children:(0,r.jsxs)(Ze.U,{contentStyle:{minWidth:280,maxWidth:"75vw"},logo:(0,r.jsx)("img",{alt:"logo",src:"https://breed-1258140596.cos.ap-shanghai.myqcloud.com/Breeding%20Platform/logo.png"}),title:"\u6DF1\u6EAF\u80B2\u79CD\u4E91\u5E73\u53F0",subTitle:M.formatMessage({id:"pages.layouts.userLayout.title"}),initialValues:{autoLogin:!0},actions:[(0,r.jsx)(b.FormattedMessage,{id:"pages.login.loginWith",defaultMessage:"\u5176\u4ED6\u767B\u5F55\u65B9\u5F0F"},"loginWith"),(0,r.jsx)(Ke,{},"icons")],onFinish:function(){var h=A()(p()().mark(function C(o){return p()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,O(o);case 2:case"end":return i.stop()}},C)}));return function(C){return h.apply(this,arguments)}}(),children:[(0,r.jsx)(Qe.Z,{activeKey:g,onChange:x,centered:!0,items:[{key:"account",label:M.formatMessage({id:"pages.login.accountLogin.tab",defaultMessage:"\u8D26\u6237\u5BC6\u7801\u767B\u5F55"})},{key:"mobile",label:M.formatMessage({id:"pages.login.phoneLogin.tab",defaultMessage:"\u624B\u673A\u53F7\u767B\u5F55"})}]}),Q==="error"&&z==="account"&&(0,r.jsx)(we,{content:q||M.formatMessage({id:"pages.login.accountLogin.errorMessage",defaultMessage:"\u8D26\u6237\u6216\u5BC6\u7801\u9519\u8BEF"})}),g==="account"&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(X.Z,{name:"username",fieldProps:{size:"large",prefix:(0,r.jsx)(ce.Z,{})},placeholder:M.formatMessage({id:"pages.login.username.placeholder",defaultMessage:"\u8BF7\u8F93\u5165\u7528\u6237\u540D"}),rules:[{required:!0,message:(0,r.jsx)(b.FormattedMessage,{id:"pages.login.username.required",defaultMessage:"\u8BF7\u8F93\u5165\u7528\u6237\u540D!"})}]}),(0,r.jsx)(X.Z.Password,{name:"password",fieldProps:{size:"large",prefix:(0,r.jsx)(N.Z,{})},placeholder:M.formatMessage({id:"pages.login.password.placeholder",defaultMessage:"\u8BF7\u8F93\u5165\u5BC6\u7801"}),rules:[{required:!0,message:(0,r.jsx)(b.FormattedMessage,{id:"pages.login.password.required",defaultMessage:"\u8BF7\u8F93\u5165\u5BC6\u7801\uFF01"})}]})]}),Q==="error"&&g==="mobile"&&(0,r.jsx)(we,{content:"\u9A8C\u8BC1\u7801\u9519\u8BEF"}),g==="mobile"&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(X.Z,{fieldProps:{size:"large",prefix:(0,r.jsx)(je.Z,{})},name:"mobile",placeholder:M.formatMessage({id:"pages.login.phoneNumber.placeholder",defaultMessage:"\u624B\u673A\u53F7"}),rules:[{required:!0,message:(0,r.jsx)(b.FormattedMessage,{id:"pages.login.phoneNumber.required",defaultMessage:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7\uFF01"})},{pattern:/^1\d{10}$/,message:(0,r.jsx)(b.FormattedMessage,{id:"pages.login.phoneNumber.invalid",defaultMessage:"\u624B\u673A\u53F7\u683C\u5F0F\u9519\u8BEF\uFF01"})}]}),(0,r.jsx)(Ue.Z,{fieldProps:{size:"large",prefix:(0,r.jsx)(N.Z,{})},captchaProps:{size:"large"},placeholder:M.formatMessage({id:"pages.login.captcha.placeholder",defaultMessage:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801"}),captchaTextRender:function(C,o){return C?"".concat(o," ").concat(M.formatMessage({id:"pages.getCaptchaSecondText",defaultMessage:"\u83B7\u53D6\u9A8C\u8BC1\u7801"})):M.formatMessage({id:"pages.login.phoneLogin.getVerificationCode",defaultMessage:"\u83B7\u53D6\u9A8C\u8BC1\u7801"})},name:"captcha",rules:[{required:!0,message:(0,r.jsx)(b.FormattedMessage,{id:"pages.login.captcha.required",defaultMessage:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801\uFF01"})}],onGetCaptcha:function(){var h=A()(p()().mark(function C(o){var d;return p()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,Ae({phone:o});case 2:if(d=y.sent,d){y.next=5;break}return y.abrupt("return");case 5:f.ZP.success("\u83B7\u53D6\u9A8C\u8BC1\u7801\u6210\u529F\uFF01\u9A8C\u8BC1\u7801\u4E3A\uFF1A1234");case 6:case"end":return y.stop()}},C)}));return function(C){return h.apply(this,arguments)}}()})]}),(0,r.jsxs)("div",{style:{marginBottom:24},children:[(0,r.jsx)(Be.Z,{noStyle:!0,name:"autoLogin",children:(0,r.jsx)(b.FormattedMessage,{id:"pages.login.rememberMe",defaultMessage:"\u81EA\u52A8\u767B\u5F55"})}),(0,r.jsx)("a",{style:{float:"right"},children:(0,r.jsx)(b.FormattedMessage,{id:"pages.login.forgotPassword",defaultMessage:"\u5FD8\u8BB0\u5BC6\u7801"})})]}),(0,r.jsx)("a",{className:k.registerLink,onClick:function(){return Y(!0)}})]})}),(0,r.jsx)(Ie.$_,{}),(0,r.jsx)(_e,{visible:H,onCancel:function(){return Y(!1)},onSuccess:function(){f.ZP.success(M.formatMessage({id:"pages.register.success",defaultMessage:"\u6CE8\u518C\u6210\u529F\uFF01\u8BF7\u767B\u5F55"}))}})]})},rr=er}}]);
